# 建設業向けEVM工程管理ツール — 要件定義ドラフト v0.3

> 本ドキュメントは **要件定義を進めるためのたたき台** です。未確定の箇所は ✅To-Decide（要決定） として明示しています。

---

## 0. 背景 / 目的
- 現場の工程管理と原価・出来高（EVM）を一体で把握し、**本社提出用資料**を素早く生成する。
- 既存Excel工程表の運用を置き換える “**デスクトップアプリ（オフライン可）**” を前提。

## 1. スコープ / 非スコープ
- **対象業務**：足場・ケレン・下塗り・中塗り・上塗り・金物交換 等の塗装/防食系プロジェクトの工程・原価・品質進捗の見える化。
- **対象ユーザー（確定）**：施工管理者・現場代理人（サブユーザー不要）。
- **非スコープ（初版）**：クラウド同期、モバイルアプリ、複数同時編集、SaaSログイン機構。

## 2. ゴール / 成果物
- **工程ガント + EVM指標（SV, CV, SPI, CPI）** を日割/稼働日で自動算出し、ダッシュボードに表示。
- **本社提出用レポート**（PDF/Excel）出力。
- **日本円（¥）表示**：3桁区切り、**小数なし**。

## 3. 想定プラットフォーム / 配布
- **配布形態**：デスクトップアプリのみ（Electron 予定）。
- **ファイル互換性**：独自フォーマット（互換性不要）。
- **実行環境**：Windows 10/11（確定）。
- **開発環境**：Mac も利用するが、成果物は Windows 動作を優先。→ 開発ツールチェーンはクロスプラットフォーム対応（Electron/Node.js でMac上でも開発可能）。

## 4. 操作/UI要件（確定/要望）
- **トップ画面**：プロジェクト一覧（カード）、新規プロジェクト作成。
- **ガント画面**：
  - **三段ヘッダ**：上=年月, 中=日, 下=曜日（固定表示）。
  - **計画バー（黒・固定）** と **実績バー（上段）** を上下段で表示。
  - 稼働日/休日（**土日休み + 任意祝日**）設定。
  - **日本円表示**（3桁区切り、小数なし）。
- **リソース**：
  - 種別 **社内直営 / 協力業者** を区別。
  - 単価計算：社内直営=日単価入力、協力業者=**請負金額 ÷ 工期** で日単価自動算出。
- **UI方向性**：Canva のような直感UI（ドラッグ&ドロップは将来、初版は入力→自動描画を優先）。

## 5. データモデル（初案）
- **Project**：id, name, startDate, endDate, calendar(週休2日/祝日), currency=JPY
- **Task**：id, projectId, name, planStart, planFinish, actualStart?, actualFinish?, progress%, resourceType(enum: 内製/協力), contractorName?, contractAmount?, plannedCost?, actualCost?, notes?
- **Calendar**：休日ルール（土日/祝日配列）

## 6. EVM仕様（初版）
- 指標：PV, EV, AC / **SV=EV−PV**, **CV=EV−AC**, **SPI=EV/PV**, **CPI=EV/AC**。
- 前提：**日割、稼働日のみカウント**（土日除外、祝日除外）。
- 進捗：
  - **計画進捗**：計画工期に均等配分（初版）。
  - **実績進捗**：タスクの `progress%` または実績バーから算出。
- **算出ルール**：初版は **均等配分の日割り**。

## 7. 入出力
- **インポート**：CSV形式（初期正式版フォーマット）。
- **エクスポート**：PDF/Excel（レポート）。
- **レポート要件**：ガントチャートで進行状況とEVM指標がわかりやすく表示されればよい。Excel様式は不要。

### CSVフォーマット（初期正式版）
```csv
ProjectName,TaskID,TaskName,Start,Finish,DurationDays,ProgressPercent,ResourceType,ContractorName,UnitCost,ContractAmount,PlannedCost,ActualCost,Notes
橋梁補修工事A,1,足場組立,2025-01-05,2025-01-10,6,100,協力,株式会社スカイ足場,50000,300000,300000,290000,高所作業含む
橋梁補修工事A,2,ケレン,2025-01-11,2025-01-15,5,80,社内,,20000,,100000,80000,第1種ケレン
橋梁補修工事A,3,下塗り（プライマー）,2025-01-16,2025-01-20,5,60,協力,塗装工業株式会社,,600000,300000,180000,鋼材防食プライマー
橋梁補修工事A,4,中塗り,2025-01-21,2025-01-25,5,20,協力,塗装工業株式会社,,600000,250000,50000,ウレタン樹脂
橋梁補修工事A,5,上塗り（トップコート）,2025-01-26,2025-01-30,5,0,協力,塗装工業株式会社,,600000,250000,0,フッ素樹脂塗装
橋梁補修工事A,6,足場解体,2025-02-01,2025-02-05,5,0,協力,株式会社スカイ足場,50000,250000,250000,0,
```

## 8. 非機能要件
- **パフォーマンス**：100〜300タスクで快適（スクロール/再描画 < 100ms 目安）。
- **オフライン**：完全オフライン動作。
- **セキュリティ**：ローカル保存、暗号化（オプション）。✅To-Decide：ファイル暗号化の要否
- **開発プロセス**：アジャイル方式（スプリントごとに要件見直し、ユーザー確認→改善）。

## 9. 権限/ユーザー
- 単一ユーザー想定（認証なし）。✅To-Decide：将来のチーム共有要件

## 10. 画面一覧（初版）
1. プロジェクト一覧
2. ガント画面（EVMパネル、タスクリスト、三段ヘッダ、上下バー）
3. 設定（稼働日/祝日、通貨、出力フォーマット）

## 11. 受け入れ基準（例）
- **EVM計算の一致**：日割/稼働日で精算したテストケースに対し、SV/CV/SPI/CPI が期待値±1円/1e−6以内。
- **三段ヘッダ**：指定期間で、年月/日/曜日が正しく整列表示される。
- **日本円表示**：全画面で3桁区切り・小数なし。
- **単価計算**：協力業者=請負金額/工期（日数）が正しい。

## 12. テストケース（サンプル）
- **TC-001**：5日工期（平日のみ）、計画コスト=¥100,000、3日目に進捗60%、実コスト¥55,000 → 指標一致
- **TC-002**：土日挟む7日間、祝日1日を除外 → 稼働日=5日で計算
- **TC-003**：協力業者：請負¥1,000,000、工期20日 → 日単価=¥50,000

## 13. ロードマップ（提案）
- **MVP**：
  - CSVインポート→ガント描画（計画/実績バー）
  - EVMパネル（リアルタイム更新）
  - PDF出力（簡易）
- **Phase 2**：
  - 休日カレンダGUI、週/月スケール、簡易ドラッグ編集
  - Excel帳票テンプレ対応（必要であれば）
- **Phase 3**：
  - リソース最適化、原価内訳、品質/安全ログ連携

## 14. To-Decide（要決定リスト）
- ファイル暗号化の要否
- 将来のチーム共有要件（ユーザー権限管理）
- 祝日データ：初版は手入力、将来的に固定日本祝日テーブル or 外部API連携のどちらか

## 15. 決定ログ（記録用）
| 日付 | 決定 | 影響範囲 |
|---|---|---|
| 2025-09-05 | Windows 10/11 のみ対応。開発環境は Mac も利用可。 | プラットフォーム |
| 2025-09-05 | レポートはガントとEVM指標がわかればよく、Excel様式不要。 | 入出力 |
| 2025-09-05 | EV 算出は均等配分の日割りで実装。 | EVM仕様 |
| 2025-09-05 | 祝日データは初版は手入力、将来的に固定日本祝日テーブルを検討。 | カレンダー |
| 2025-09-05 | 開発はアジャイル方式で進める。 | 開発プロセス |
| 2025-09-05 | CSVフォーマットを初期正式版として確定。 | 入出力 |
