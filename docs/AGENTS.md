# AGENTS rules

本リポジトリでコーディングエージェント（Codex CLI）を使う際の簡易ルール。安全・小さく・検証可能な変更を徹底する。

## 基本姿勢
- 最小差分: スコープ外のリファクタや無関係修正はしない。
- 既存スタイル順守: 既存の命名・配置・型設計に合わせる。
- 型安全/堅牢: 例外・未定義・日付/数値パースの失敗に配慮。
- ドキュメント更新: 仕様に影響する変更は docs を同時に更新。

## 作業フロー
1) リポジトリを素早く探索（`rg`, `sed -n`）。
2) 非自明・複数工程の作業は `update_plan` で TODO を共有。
3) 変更は `apply_patch` で最小限の差分を作成。
4) テスト実行（`npm test` / `npm run test:ui`）。失敗時は原因に限定して修正。
5) 完了報告は簡潔に（何を・どこに・なぜ）。

## シェル/権限
- 検索は `rg` 優先。大きなファイルは 250 行以内で読む（`sed -n`）。
- ネットワークアクセスや破壊的操作は行わない。必要時は明示して承認を得る。
- ワークスペース外へは書き込まない。

## コーディング規約
- TypeScript/React は strict モード前提。`undefined`/`null` を区別する。
- コメントは最小限。意図や仕様上の判断がある場合のみ補足。
- 一文字変数は使わない。関数は副作用を小さく保つ。
- 日付は `YYYY-MM-DD` を基本とし、ローカルタイム/UTC の切り替えに注意。

## テスト方針
- 単体テストで周辺影響を最小に検証。既存テストの近くに追加する。
- まず変更箇所に最も近い層をテスト → 広げる。
- UI は `ui/vite.config.ts` の設定で jsdom。スナップショット更新は慎重に。

## 返答スタイル
- 日本語で簡潔に。見出しと箇条書きを活用。
- コマンド/パス/識別子はバッククォートで囲む（例: `evm-mvp-sprint1/parseCsv.ts:10`）。
- 大きなファイルの全文貼り付けはしない。必要部分だけ引用。

## 変更の原則
- ルート原因を修正。表面的なワークアラウンドは避ける。
- 可観測性: エラー時のメッセージやカウント（rows/imported/failed）を正しく返す。
- 互換性: 既存 I/F を壊さない。破壊的変更は要相談。
